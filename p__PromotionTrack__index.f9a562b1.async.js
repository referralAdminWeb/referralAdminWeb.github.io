(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[798],{46809:function(sa,q,t){"use strict";t.r(q),t.d(q,{default:function(){return We}});var me=t(64599),_=t.n(me),ge=t(19632),xe=t.n(ge),je=t(15009),x=t.n(je),Se=t(99289),H=t.n(Se),ye=t(9783),De=t.n(ye),Ie=t(97857),N=t.n(Ie),Ze=t(5574),v=t.n(Ze),Fe=t(13769),ee=t.n(Fe),b=t(75359),w=t(29933),J=t(94272),K=t(53025),ae=t(26915),te=t(2453),Q=t(78957),re=t(4393),A=t(55054),Ce=t(74330),R=t(78045),ne=t(83622),U=t(96068),Te=t(85265),Ee=t(27484),W=t.n(Ee),Pe=t(9220),s=t(67294),O=t(84105),Le=t(80652),e=t(85893),Be=function(d){var f=d.type,u=d.value,Z=(0,s.useState)(!1),i=v()(Z,2),m=i[0],p=i[1],D=(0,J.useIntl)(),F=(0,s.useState)([]),E=v()(F,2),j=E[0],C=E[1],M=function(){var c=H()(x()().mark(function o(){var h,g,a,B,P,z;return x()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.prev=0,p(!0),I.next=4,b.Z.promotionTrack.getListByDay(30,f,u);case 4:if(h=I.sent,h){g=[],a=_()(h);try{for(a.s();!(B=a.n()).done;)P=B.value,z=W()(P.date).format("YYYY-MM-DD"),g.push({date:z,type:D.formatMessage({id:"pages.promotionTrack.view"}),count:P.view}),g.push({date:z,type:D.formatMessage({id:"pages.promotionTrack.download"}),count:P.download}),g.push({date:z,type:D.formatMessage({id:"pages.promotionTrack.register"}),count:P.register})}catch(G){a.e(G)}finally{a.f()}g=g.reverse(),C(g)}p(!1),I.next=14;break;case 9:return I.prev=9,I.t0=I.catch(0),p(!1),console.error(I.t0),I.abrupt("return",!1);case 14:case"end":return I.stop()}},o,null,[[0,9]])}));return function(){return c.apply(this,arguments)}}();return(0,s.useEffect)(function(){M()},[f,u]),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Le.Z,{data:j,xField:"date",yField:"count",colorField:"type",axis:{y:{labelFormatter:function(o){return o.toLocaleString()}}},shapeField:"smooth",scale:{y:{domainMin:0}},tooltip:{channel:"y",valueFormatter:function(o){return o.toLocaleString()}}})})},Me=Be,ke=function(d){var f=d.type,u=d.value,Z=(0,s.useState)(!1),i=v()(Z,2),m=i[0],p=i[1],D=(0,s.useState)([]),F=v()(D,2),E=F[0],j=F[1],C=[{title:"date",dataIndex:"date",render:function(o,h,g){return W()(o).format("YYYY-MM-DD")}},{title:"\u8BBF\u95EE\u6B21\u6570",dataIndex:"view"},{title:"\u4E0B\u8F7D\u6B21\u6570",dataIndex:"download"},{title:"\u6CE8\u518C\u6B21\u6570",dataIndex:"register"},{title:"\u72EC\u7ACBIP\u6570",dataIndex:"ip"},{title:"\u72EC\u7ACB\u8BBE\u5907\u6570",dataIndex:"deviceId"}],M=function(){var c=H()(x()().mark(function o(){var h;return x()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,p(!0),a.next=4,b.Z.promotionTrack.getListByLimit(90,f,u);case 4:h=a.sent,h&&j(h),p(!1),a.next=14;break;case 9:return a.prev=9,a.t0=a.catch(0),p(!1),console.error(a.t0),a.abrupt("return",!1);case 14:case"end":return a.stop()}},o,null,[[0,9]])}));return function(){return c.apply(this,arguments)}}();return(0,s.useEffect)(function(){M()},[f,u]),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(U.Z,{size:"small",columns:C,dataSource:E,pagination:!1})})},we=ke,Ne=function(d){var f=d.type,u=d.value,Z=(0,s.useState)(!1),i=v()(Z,2),m=i[0],p=i[1],D=(0,s.useState)([]),F=v()(D,2),E=F[0],j=F[1],C=[{title:"\u65F6\u95F4",dataIndex:"eventTime",render:function(o,h,g){return W().unix(o).format("YYYY-MM-DD")},minWidth:120},{title:"Category",dataIndex:"category"},{title:"utm_source",dataIndex:"utmSource"},{title:"eid",dataIndex:"eid"},{title:"pid",dataIndex:"pid"},{title:"code",dataIndex:"code"},{title:"user_agent",dataIndex:"user_agent"},{title:"browser",dataIndex:"browser"},{title:"deviceId",dataIndex:"deviceId"},{title:"device",dataIndex:"device"},{title:"ip",dataIndex:"ip"},{title:"platform",dataIndex:"platform"},{title:"geo",dataIndex:"geo"},{title:"lang",dataIndex:"lang"},{title:"countryCode",dataIndex:"countryCode"},{title:"referer",dataIndex:"referer"},{title:"extra",dataIndex:"extra"}],M=function(){var c=H()(x()().mark(function o(){var h;return x()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,p(!0),a.next=4,b.Z.promotionTrack.getLogListByLimit(100,f,u);case 4:h=a.sent,h&&j(h),p(!1),a.next=14;break;case 9:return a.prev=9,a.t0=a.catch(0),p(!1),console.error(a.t0),a.abrupt("return",!1);case 14:case"end":return a.stop()}},o,null,[[0,9]])}));return function(){return c.apply(this,arguments)}}();return(0,s.useEffect)(function(){M()},[f,u]),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(U.Z,{size:"small",scroll:{x:!0},columns:C,dataSource:E,pagination:!1})})},Re=Ne,se=w.Z.Divider,Ye=function(d){var f=d.type,u=d.value,Z=(0,s.useState)(void 0),i=v()(Z,2),m=i[0],p=i[1],D=(0,J.useIntl)(),F=function(){var E=H()(x()().mark(function j(){var C;return x()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,b.Z.promotionTrack.getAccumulatedData(f,u);case 2:C=c.sent,p(C.data);case 4:case"end":return c.stop()}},j)}));return function(){return E.apply(this,arguments)}}();return(0,s.useEffect)(function(){F()},[]),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"h1",children:"".concat(D.formatMessage({id:"pages.promotionTrack.utm_source"}),": ").concat(u)}),(0,e.jsx)("div",{children:(0,e.jsxs)(w.Z.Group,{direction:"row",children:[(0,e.jsx)(w.Z,{children:(0,e.jsx)(A.Z,{title:"\u7D2F\u8BA1\u8BBF\u95EE",value:m?m.view:"-"})}),(0,e.jsx)(se,{type:"vertical"}),(0,e.jsx)(w.Z,{children:(0,e.jsx)(A.Z,{title:"\u7D2F\u8BA1\u4E0B\u8F7D",value:m?m.download:"-"})}),(0,e.jsx)(se,{type:"vertical"}),(0,e.jsx)(w.Z,{children:(0,e.jsx)(A.Z,{title:"\u7D2F\u8BA1\u6CE8\u518C",value:m?m.register:"-"})})]})}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"h3",children:"30\u5929\u63A8\u5E7F\u66F2\u7EBF"}),(0,e.jsx)(Me,{type:f,value:u})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"h3",children:"\u8BBF\u95EE\u7EDF\u8BA1\u6570\u636E \uFF08\u6CE8\u610F\uFF0C\u53D6\u6700\u8FD190\u6761\uFF09"}),(0,e.jsx)(we,{type:f,value:u})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"h3",children:"\u8BBF\u95EE\u65E5\u5FD7 \uFF08\u6CE8\uFF0C\u53D6\u6700\u8FD1100\u6761\uFF09"}),(0,e.jsx)(Re,{type:f,value:u})]})]})},He=Ye,be=["index"],ze=["title","editable","children","dataIndex","record","handleSave"],ie=s.createContext(null),Ae=function(d){var f=d.index,u=ee()(d,be),Z=K.Z.useForm(),i=v()(Z,1),m=i[0];return(0,e.jsx)(K.Z,{form:m,component:!1,children:(0,e.jsx)(ie.Provider,{value:m,children:(0,e.jsx)("tr",N()({},u))})})},$e=function(d){var f=d.title,u=d.editable,Z=d.children,i=d.dataIndex,m=d.record,p=d.handleSave,D=ee()(d,ze),F=(0,s.useState)(!1),E=v()(F,2),j=E[0],C=E[1],M=(0,s.useRef)(null),c=(0,s.useContext)(ie);(0,s.useEffect)(function(){if(j){var a;(a=M.current)===null||a===void 0||a.focus()}},[j]);var o=function(){C(!j),c.setFieldsValue(De()({},i,m[i]))},h=function(){var a=H()(x()().mark(function B(){var P;return x()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.prev=0,T.next=3,c.validateFields();case 3:P=T.sent,o(),p(N()(N()({},m),P)),T.next=11;break;case 8:T.prev=8,T.t0=T.catch(0),console.log("Save failed:",T.t0);case 11:case"end":return T.stop()}},B,null,[[0,8]])}));return function(){return a.apply(this,arguments)}}(),g=Z;return u&&(g=j?(0,e.jsx)(K.Z.Item,{style:{margin:0},name:i,normalize:function(B){return B==null?void 0:B.trim()},children:(0,e.jsx)(ae.Z,{ref:M,onPressEnter:h,onBlur:h})}):(0,e.jsx)("div",{className:"editable-cell-value-wrap",style:{paddingInlineEnd:24},onClick:o,children:Z})),(0,e.jsx)("td",N()(N()({},D),{},{children:g}))},le=w.Z.Divider,Ge=function(){var d=(0,s.useState)(void 0),f=v()(d,2),u=f[0],Z=f[1],i=(0,J.useIntl)(),m=(0,s.useState)([]),p=v()(m,2),D=p[0],F=p[1],E=(0,s.useState)(!1),j=v()(E,2),C=j[0],M=j[1],c=(0,s.useState)(!1),o=v()(c,2),h=o[0],g=o[1],a=(0,s.useState)("24H"),B=v()(a,2),P=B[0],z=B[1],T=(0,s.useState)("utm_source"),I=v()(T,2),G=I[0],Oe=I[1],Ve=(0,s.useState)(""),ue=v()(Ve,2),de=ue[0],oe=ue[1],Je=(0,s.useState)(!1),ce=v()(Je,2),Ke=ce[0],ve=ce[1],Qe=(0,s.useState)(void 0),fe=v()(Qe,2),X=fe[0],pe=fe[1],Ue={body:{row:Ae,cell:$e}},Xe=function(){var l=H()(x()().mark(function r(n){var S,L,y;return x()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.prev=0,k.next=3,b.Z.promotionTrack.editRemark(n.typ,n.value,n.remark);case 3:te.ZP.success(i.formatMessage({id:"pages.vipList.update.success"})),S=xe()(D),L=S.findIndex(function(V){return n.value===V.value}),y=S[L],S.splice(L,1,N()(N()({},y),n)),F(S),k.next=14;break;case 11:k.prev=11,k.t0=k.catch(0),te.ZP.success(i.formatMessage({id:"pages.vipList.update.error"}));case 14:case"end":return k.stop()}},r,null,[[0,11]])}));return function(n){return l.apply(this,arguments)}}(),qe=function(r){Xe(r)},_e=[{title:"ID",dataIndex:"value",width:360,render:function(r,n){return(0,e.jsx)(Q.Z,{size:"middle",children:(0,e.jsx)("div",{className:"link-btn",onClick:function(){pe({type:G,value:n.value}),ve(!0)},children:n.value.length>40?n.value.substring(0,40)+"...":n.value})})}},{title:"\u8BBF\u95EE\u6B21\u6570",dataIndex:"view",sorter:function(r,n){return r.view-n.view}},{title:"\u4E0B\u8F7D\u6B21\u6570",dataIndex:"download",sorter:function(r,n){return r.download-n.download}},{title:"\u6CE8\u518C\u6B21\u6570",dataIndex:"register",sorter:function(r,n){return r.register-n.register}},{title:"\u72EC\u7ACBIP\u6570",dataIndex:"ip",sorter:function(r,n){return r.ip-n.ip}},{title:"\u72EC\u7ACB\u8BBE\u5907\u6570",dataIndex:"deviceId",sorter:function(r,n){return r.deviceId-n.deviceId}},{title:"\u5907\u6CE8\u4FE1\u606F",dataIndex:"remark",editable:!0,minWidth:100}],ea=_e.map(function(l){return l.editable?N()(N()({},l),{},{onCell:function(n){return{record:n,editable:l.editable,dataIndex:l.dataIndex,title:l.title,handleSave:qe}}}):l}),aa=function(){var l=H()(x()().mark(function r(){var n;return x()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,b.Z.promotionTrack.get24HData();case 2:n=L.sent,Z(n.data);case 4:case"end":return L.stop()}},r)}));return function(){return l.apply(this,arguments)}}(),he=function(){var l=H()(x()().mark(function r(n){var S;return x()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return g(!0),y.next=3,b.Z.promotionTrack.getStatisticalList(P,G,n);case 3:S=y.sent,S.data&&F(S.data),g(!1);case 6:case"end":return y.stop()}},r)}));return function(n){return l.apply(this,arguments)}}();(0,s.useEffect)(function(){aa()},[]),(0,s.useEffect)(function(){oe(""),he("")},[G,P]);var ta=function(){var r=[];r.push("ID"),r.push("\u8BBF\u95EE\u6B21\u6570"),r.push("\u4E0B\u8F7D\u6B21\u6570"),r.push("\u6CE8\u518C\u6B21\u6570"),r.push("\u72EC\u7ACBIP\u6570"),r.push("\u72EC\u7ACB\u8BBE\u5907\u6570"),r.push("\u5907\u6CE8\u4FE1\u606F");var n=[];n.push(r);var S=_()(D),L;try{for(S.s();!(L=S.n()).done;){var y=L.value,Y=[];Y.push(y.value),Y.push(y.view),Y.push(y.download),Y.push(y.register),Y.push(y.ip),Y.push(y.deviceId),Y.push(y.remark),n.push(Y)}}catch(na){S.e(na)}finally{S.f()}var k=O.P6.aoa_to_sheet(n),V=O.P6.book_new();O.P6.book_append_sheet(V,k,"Sheet1");var ra="promotionTrack_".concat(P,"_").concat(W()().format("YYYYMMDDHHmmss"),".xlsx");O.NC(V,ra)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(re.Z,{children:(0,e.jsx)(Pe.Z,{onResize:function(r){M(r.width<596)},children:(0,e.jsxs)(w.Z.Group,{direction:C?"column":"row",children:[(0,e.jsx)(w.Z,{children:(0,e.jsx)(A.Z,{title:"24H\u603B\u8BBF\u95EE",value:u?u.view:"-"})}),(0,e.jsx)(le,{type:C?"horizontal":"vertical"}),(0,e.jsx)(w.Z,{children:(0,e.jsx)(A.Z,{title:"24H\u603B\u4E0B\u8F7D",value:u?u.download:"-"})}),(0,e.jsx)(le,{type:C?"horizontal":"vertical"}),(0,e.jsx)(w.Z,{children:(0,e.jsx)(A.Z,{title:"24H\u6CE8\u518C\u6570",value:u?u.register:"-"})})]})},"resize-observer")}),(0,e.jsx)(re.Z,{children:(0,e.jsxs)(Ce.Z,{spinning:h,tip:i.formatMessage({id:"loading"}),children:[(0,e.jsxs)("div",{className:"tools",children:[(0,e.jsxs)("div",{className:"search",children:[(0,e.jsx)("div",{className:"item",children:(0,e.jsx)(Q.Z,{children:(0,e.jsxs)(R.ZP.Group,{value:G,onChange:function(r){return Oe(r.target.value)},children:[(0,e.jsx)(R.ZP.Button,{value:"utm_source",children:i.formatMessage({id:"pages.promotionTrack.utm_source"})}),(0,e.jsx)(R.ZP.Button,{value:"eid",children:i.formatMessage({id:"pages.promotionTrack.eid"})}),(0,e.jsx)(R.ZP.Button,{value:"pid",children:i.formatMessage({id:"pages.promotionTrack.pid"})}),(0,e.jsx)(R.ZP.Button,{value:"code",children:i.formatMessage({id:"pages.promotionTrack.code"})})]})})}),(0,e.jsx)("div",{className:"item",children:(0,e.jsx)(ae.Z,{value:de,onChange:function(r){return oe(r.target.value.trim())}})}),(0,e.jsx)("div",{className:"item",children:(0,e.jsx)(ne.ZP,{onClick:function(){return he(de)},children:"\u641C\u7D22"})})]}),(0,e.jsxs)("div",{className:"filter",children:[(0,e.jsx)("div",{children:(0,e.jsx)(ne.ZP,{className:"export",onClick:ta,type:"link",children:i.formatMessage({id:"export"})})}),(0,e.jsx)(Q.Z,{children:(0,e.jsxs)(R.ZP.Group,{value:P,onChange:function(r){return z(r.target.value)},children:[(0,e.jsx)(R.ZP.Button,{value:"24H",children:"24H"}),(0,e.jsx)(R.ZP.Button,{value:"7D",children:"7D"}),(0,e.jsx)(R.ZP.Button,{value:"1M",children:"1M"})]})})]})]}),(0,e.jsx)("div",{children:(0,e.jsx)(U.Z,{components:Ue,rowClassName:"editable-row",columns:ea,dataSource:D,pagination:!1})}),(0,e.jsx)(Te.Z,{width:1e3,open:Ke,onClose:function(){pe(void 0),ve(!1)},closable:!1,children:X&&(0,e.jsx)(He,{type:X.type,value:X.value})})]})})]})},We=Ge},20067:function(){}}]);
